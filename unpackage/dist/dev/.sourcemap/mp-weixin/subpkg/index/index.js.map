{"version":3,"sources":["uni-app:///main.js","webpack:///E:/项目文件/发薪平台/youpin_list_v1.0/subpkg/index/index.vue?b4b0","webpack:///E:/项目文件/发薪平台/youpin_list_v1.0/subpkg/index/index.vue?b41d","webpack:///E:/项目文件/发薪平台/youpin_list_v1.0/subpkg/index/index.vue?303c","webpack:///E:/项目文件/发薪平台/youpin_list_v1.0/subpkg/index/index.vue?f80f","uni-app:///subpkg/index/index.vue","webpack:///E:/项目文件/发薪平台/youpin_list_v1.0/subpkg/index/index.vue?d2ff"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","uNavbar","e","message","indexOf","console","error","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped","data","period","ifSingle","showLogin","imgUrl","marginTop","tabMargin","list","scrollHeight","currentPage","pagination","tabbarHeight","systemHeight","inputHeight","inputing","cancelRecord","showVoice","voicePermisson","showSend","question","historyList","qaList","jobId","action","noMayAsk","historyId","newUser","loadAllHistory","statusBarHeight","abnormalClose","abnormalErr","header","timer","responseStr","responCount","prinTimer","currentQalength","curRespone","content","origin","msg_type","card","currentProjectDetail","id","name","worker_salary_min","worker_salary_max","worker_salary_type","manager","touchStartTime","touchEndTime","responEnd","showChat","tabbar","login","chat","computed","onLoad","onReady","commonMethods","onReachBottom","onShow","_this","uni","onHide","app","onUnload","watch","handler","deep","methods","inputBindFocus","onInput","doSend","sendQuestion","send","title","showCancel","confirmText","success","param","fail","icon","duration","getHistory","newArr","resolve","getWorkInfo","msg","type","getMoreHistory","setTimeout","handleList","arr","makePhoneCall","closeLogin","cancelLogin","url","handleLogin","getTabbarHeight","creatConnect","res","connectWebsocket","method","noInput","resetData","initWebsocket","clearInterval","handleConnectErr","printStr","jobs","may_ask","getQrcode","sendBtnMsg","strArr","random","close","printResponse","str","index","getMayAsk","obj","listenKeyBoard","height","initRecord","handleRecorder","tempFilePath","filePath","mergedArray","offset","voice","media","key","second","anmitionPlay","showTranIcon","showTranlate","showTransing","stringToUint8Array","startRecord","lang","getSetting","stopRecord","cancelVoice","openSetting","scope","complete","changeChatMethod","handleTouchMove","setScrollHeight"],"mappings":"6IAAA,MAGA,aACA,YAFAA,EAAGC,kCAAoCC,EAGvCC,EAAWC,a,gFCLX,oIACIC,EADJ,QASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,WACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,yBACZ,aAAAF,E,0CCvBf,uQ,iCCAA,IAAIG,EAAJ,0LACA,IACEA,EAAa,CACXC,QAAS,WACP,OAAO,sHAKX,MAAOC,GACP,IAC+C,IAA7CA,EAAEC,QAAQC,QAAQ,wBACa,IAA/BF,EAAEC,QAAQC,QAAQ,QAWlB,MAAMF,EATNG,QAAQC,MAAMJ,EAAEC,SAChBE,QAAQC,MAAM,mBACdD,QAAQC,MACN,uFAEFD,QAAQC,MACN,mDAMN,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eACJH,EAAII,MAAMC,IAEjBC,GAAmB,EACnBC,EAAkB,GACtBR,EAAOS,eAAgB,G,iCCjCvB,yHAAioB,eAAG,G,kKC0EpoB,YAEA,YACA,WACA,QAGA,k7BACA,aACA,CACAC,gBACA,OACAC,4BACAC,kCACAC,aACAC,iCACAC,iCACAC,iCACAC,QACAC,eACAC,cACAC,cACAC,eACAC,uCACAC,cACAC,YACAC,gBACAC,aACAC,kBACAC,YACAC,YACAC,eACAC,UACAC,SACAC,UACAC,YACAC,aACAC,WACAC,kBACAC,6CACAC,iBACAC,eACAC,YACAC,WACAC,eACAC,cACAC,eACAC,kBACAC,YACAC,WACAC,YACAC,gBACAC,WAEAC,sBACAC,MACAC,QACAC,qBACAC,qBACAC,uBAEAC,6BACAC,kBACAC,gBACAC,aACAC,cAGArE,YACAsE,SACAC,QACAC,QAEAC,eACA,0GACA,mFACA,iCAGAC,mBAAA,oIACArE,wBACA,iBACA,gBACA,iBACA,YACA,OACA,cAEA,cACA,iBAEA,gBACA,0CAbA,IAgBAsE,mBAAA,oJACAC,4CAAA,wBACA,YACA,kDACA,mDAEAvE,4CAAA,0CANA,IAQAwE,2BACAC,kBAAA,0IAQA,GAPAC,IACA,cACAxB,WACAC,YACAC,gBACAC,WAEA,eACA,gEAGA,6BACA,+BACA,4CACA,wBACAqB,8BAEAC,2CAAA,wBAEA,0DApBA,IAwBAC,kBACAC,0BACAA,6BACAA,8BACAA,6BACAA,8BACAF,gDAEAG,oBACA,iBACA,aACAH,iBAEAI,OACAhD,qBACA/B,kCAIA,gBAHA,GAMA6C,wBACA7C,sCAGAiC,QACA+C,sBACAhF,wCAEAiF,UAGAC,gBACA,iGACA,wFACA,8FACA,kGACA,0DACA,8FACA,kFACA,6DACA,IACAC,2BACA,eAIA,kBACA,kCAJA,mBAOAC,oBACA,8BAEAC,qBACA,0BAEA,yBAGA,QAEA,oBAEAxF,qBAIAyF,wBAEA,kBAGA,mBACA,OACApC,sBACAC,kBACAC,iBAGA,gCAGAmC,qBACA,WACA,cASAvF,+EACA,oCACA,gCACAwF,yBACAC,cACAC,mBAIA,eAIA,4BACAf,gBAEA,iBAEA,kBAEA,iBACAE,8BACAjE,kCACA,UACA,kBACA,eACA,uBAEA+E,oBACAjB,WACAA,YACAA,cACAA,uBACAA,8BACAA,wBACAC,gBACA,YACA,iBACAD,kBACAkB,cACAlB,mCACAA,QACAA,iBACAA,oBAOAmB,iBACAnB,gBA3DAC,aACAa,gBACAM,aACAC,gBA8DAC,sBACA,WAEA,OADAhG,sBACA,yBACA,4EACA0E,2CACA,cACA,iBAEAA,aAEAA,aAEA,uBACA,gBACA,MACAA,0BAEAuB,kBACAC,aAMAC,wBAAA,WACA,aACA,mCACA,cACA,OACAC,gBACAC,WACAnE,QACAC,WAEA,qBAIAmE,0BAAA,WACA,OACA,uBA+BA3B,aACAa,cACAM,YACAC,eAEAQ,uBACA7B,mCACA,SAtCA,CACA,oBACA,uCAEA,YADA,oCAGA,eAGAC,gBACA,+EACA,qCACA,cACA,oBAIA,GAHAA,gBACA,8BACA,iCACA,KACA,uBACA,kBACA,sCACA,iCACA,8BAEA,yBAGA,sCAiBA6B,uBAEA,IADA,eACA,YACA,yBAEAC,2BACAA,qBACAA,sBAGA,UAGAC,yBACA,uCAEAC,sBACA,mBAEAC,uBACA,kBACAjC,aACAkC,0CAGAC,uBAAA,0IAEA,OADApC,IACA,uBACA,2CACA,wBACAA,8BAEA,2DAPA,IASAqC,4BACA,qBAEAC,wBAAA,0IAYA,GAXAtC,EACA,UACA,kCACA,8BACA,mEACA,mDAEA,mBACA,kBAIAG,yBAAA,+BAKA,2CACA,UAEA,GAAA7E,uCACA,sEAIA,WAGA,mCACA,qCAAAiH,SACA,8BACA,kBACA,2CAjCA,IAmCAC,6BAKA,gCACArC,yCACAgC,wBACAlE,SACAwE,aACAxB,oBAIAO,MAEAL,iBACA7F,sBACA2E,aACAa,eACAC,uBAOA2B,mBACA,WACA,mCACA,eACA1C,kBACA,MAEA2C,qBACA,qBACA,iBACAnE,WACAC,YACAC,gBACAC,WAEA,mBACA,oBACA,mBAGAiE,yBAAA,WACA,OACAzC,4CACA,mBACA,iBACA,iBACA,iBACA,mBACA,wBACA,gBACA,eACAF,gBACA,SACA,uBAEA,+CACAD,iBAEA1E,kCAEA6E,6CACA,iBACAA,6BACA0C,uBACA,mBACA,wBACA,gBACA,iBACA,iBAIA,iBACAhB,uBACA7B,mBACA,QAIAG,+CACA,mBAEAH,uBAEA,yBAEA,GADA1E,8BACA,iBAEA,OACAqG,cAEA3B,gDAEA,+BAEA,OACA2B,yBAEA3B,yBACAA,gDAEA,sBAEA,OACA2B,gBAEA3B,yBACAA,qBACAA,gDAEA,qBACAA,gBACAA,yBACA,mBACAA,kCACAA,kBACA,iBACAA,yBAIAA,eAEA1E,oCACA,eACA0E,kBAIAG,2CAAA,0HASA,OARA,mBAEA7E,yBACA6E,6BACA,gBACA,iBACA,iBACA,YACA,wBACA,4CAIA0C,uBACA,eACAhB,uBACA7B,mBACA,KACA,4CAEA,mDArBAG,KAuBA2C,4BAEA,yBACA,6CACA,sBACA,mBACA,2BACA,iBACAD,8BAEA,OACArE,2CACAuE,YACArE,gBACAD,YACAuE,QACAC,YAEA,sBAIAC,sBAAA,WACA,MAGA,2DACA,mCACA,WACA,qCAIAC,uBAAA,4IAMA,GALA7H,gCACA0E,EAKA,4BACA,mDAGA,0BAKA,OAJAC,aACAa,gBACAM,aACAC,eACA,8BAIA,oEASA,iBACA,kBACA,eAEA+B,KACAA,sBACAA,kCACAA,mCACAA,kCACAA,iCACAC,qCACA,iBAEA,iBAEA,4DA5CA,IA+CAC,iBACA,gCACA,yBACAnD,oCAIAoD,yBACA,WACA,IACA,KAEA,uCACA,2BACA,QACAC,oBACAxD,iCACA,WACAA,cAEAA,qCACAyD,SAEA,cACA,oBACAzD,+BAEA6C,2BACAvH,qCACA0E,gBACAA,cACAA,wBACA,SACAA,0BAIA,KAGA0D,qBAAA,WAEA,GACA,+BAEA,IACA,KACApI,yBACA,4EACA,aAEAmI,2BACAE,qBACAA,sBACA,2BAEAF,oBACAE,OACA,aAEAA,sBACA,0BAKAC,2BACA,aACA,mBACA,4DAEA,sEACAC,OACA,wBAGAC,sBAAA,WAEA,kCACA,iBAGA,iCAEA,cACA,oCACA,oBAEA7D,aACAa,eACAM,kBAKA,kCAEA,kBAIA2C,2BAGA,IAFAC,iBACA3C,aAEA,iBACA,WACA,MACApB,aACAa,eACAM,aACAC,eAKA,kBAiDA,qBAhDA7G,mCACAyJ,WACAhD,oBAEA,aACA,oBACA,uBACA,+BAGA,oDAGA,oBAEA,oBAEA,IACAiD,WACAC,YAEAD,WAEA,OACArF,KACAL,WACAC,kBACAC,iBACA0F,OACAC,OACAC,OACAnC,OAEAoC,aACAC,iBAEAC,gBACAC,gBACAC,iBAEA3E,4BAGAmB,iBACA7F,+BAUAsJ,+BAIA,IAHA,sCACA,WACA,oBACA,YACA7C,qBAEA,UAEA8C,wBACA,WACA,eAIA,aAQA,aASA,eAGA7E,6BACAA,+BACAC,gBACAgB,uBAEAjB,kBACAA,iBACAqB,aACAyD,gBAnBA7E,aACAa,gBACAM,aACAC,eAXApB,aACAa,gBACAM,aACAC,eAPA,mBAkCA0D,sBACA,WACA9E,cACAgB,oBACA,8BAIAjB,oBAHAA,qBAOAmB,sBAGA6D,uBACA,WACA,iBACA,8BACA,0CACA,oBAEAnD,uBACA7B,mBACA,MAIAiF,wBACA,iBAEA,qBAEAC,uBACA,WACA,gCACA,EACAjF,eACAgB,oBACA,gCACAjB,oBACAA,iBAGAmB,iBACAnB,uBAIAC,aACAkF,qBACAlE,oBACAjB,oBACAA,gBAEAmB,iBAEAnB,qBAEAoF,oBACAnF,qCAKAoF,4BACA,eASA,kBANA,oBAGA,kBAFA,oBAQAC,4BACA,iBAGA,6DAEA,oBADA,IAMAC,2BACA,+DAIA,c,6ECriCA,yHAAgtC,eAAG,G","file":"subpkg/index/index.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './subpkg/index/index.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=f8b49f40&scoped=true&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=f8b49f40&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f8b49f40\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"subpkg/index/index.vue\"\nexport default component.exports","export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=f8b49f40&scoped=true&\"","var components\ntry {\n  components = {\n    uNavbar: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uview-ui/components/u-navbar/u-navbar\" */ \"@/uni_modules/uview-ui/components/u-navbar/u-navbar.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"single_page\" v-if=\"ifSingle\">\r\n\t\t<image :src=\"imgUrl+'/worker/single_page.png'\" mode=\"widthFix\" style=\"width: 100%;\"></image>\r\n\t</view>\r\n\t<view class=\"content\" v-else style=\"background: #F6F5FA;\">\r\n\t\t<!-- 自定义导航栏 -->\r\n\t\t<u-navbar title=\"灵动优聘\" :safeAreaInsetTop=\"true\" :titleStyle=\"{lineHeight:'44px'}\" bgColor=\"transparent\">\r\n\t\t\t<!-- <view class=\"u-nav-slot flex flex-start\" slot=\"left\">\r\n\t\t\t\t<view class=\"ic_menu\">\r\n\t\t\t\t\t<image :src=\"imgUrl+'/worker/v_list/text_logo.png'\" mode=\"heightFix\" style=\"height:33px;\"></image>\r\n\t\t\t\t</view>\r\n\t\t\t</view> -->\r\n\t\t</u-navbar>\r\n\t\t<view class=\"cont\" :style=\"{marginTop:marginTop+tabMargin+'px'}\">\r\n\t\t\t<chat v-if=\"showChat\" ref=\"chatRef\" :top=\"statusBarHeight+44\" :bottom=\"botSafe\" :historyList=\"historyList\"\r\n\t\t\t\t:qaList=\"qaList\" :scrollHeight=\"scrollHeight\" :answering=\"answering\" :answerContinue=\"answerContinue\"\r\n\t\t\t\t:scrollStr=\"scrollStr\" @sendMsg=\"sendBtnMsg\" @moreHis=\"getMoreHistory\" @tocall=\"toCall\"\r\n\t\t\t\t@setScrollHeight=\"setScrollHeight\">\r\n\t\t\t</chat>\r\n\t\t</view>\r\n\t\t<view class=\"input_btn_wrap\"\r\n\t\t\t:style=\"{bottom:inputHeight?inputHeight+10+'px':tabbarHeight+1.5*tabMargin+'px',background:inputing?(cancelRecord?'#fe697f':'#216ff9'):'#fff'}\"\r\n\t\t\t:class=\"inputHeight?'upper':''\">\r\n\t\t\t<view>\r\n\t\t\t\t<!-- 风铃icon -->\r\n\t\t\t\t<view class=\"fl_icon\" @click.stop=\"clickFengling\">\r\n\t\t\t\t\t<image :src=\"imgUrl+'/worker/new/ic_fengling.png'\"></image>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view>\r\n\t\t\t\t\t<!-- 语音按钮区 -->\r\n\t\t\t\t\t<view class=\"voice_btn_wrap\" v-show=\"showVoice && voicePermisson\" @touchstart.stop=\"startRecord\"\r\n\t\t\t\t\t\t@touchend.stop=\"stopRecord\" @touchmove.stop=\"handleTouchMove\" @touchcancel.stop=\"cancelVoice\">\r\n\t\t\t\t\t\t<view v-show=\"!inputing\">{{canSend?\"按住 说话\":\"正在努力思考，请稍后\"}}</view>\r\n\t\t\t\t\t\t<view class=\"voice_inputing\" v-show=\"inputing\">\r\n\t\t\t\t\t\t\t<image :src=\"imgUrl+'/worker/new/inputing_wave2.gif'\" mode=\"heightFix\"></image>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"input_box\" v-show=\"!showVoice\">\r\n\t\t\t\t\t\t<input type=\"text\" confirm-type=\"发送\" :value=\"question\" :placeholder=\"canSend?'更多工作就问我':'请稍后...'\"\r\n\t\t\t\t\t\t\t@focus=\"inputBindFocus\" @confirm=\"doSend\" :disabled=\"!canSend\" @input=\"onInput\"\r\n\t\t\t\t\t\t\t:adjust-position=\"false\" style=\"padding-left: 20rpx;\" />\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\r\n\t\t\t\t<!-- 右侧输入按钮切换区 -->\r\n\t\t\t\t<view class=\"func_icon\" v-show=\"showSend\" @click.stop=\"doSend\">\r\n\t\t\t\t\t<image :src=\"imgUrl+'/worker/ic_send.png'\" style=\"border:1px solid #D8E6FF;border-radius: 50%;\">\r\n\t\t\t\t\t</image>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"func_icon\" @click.stop=\"changeChatMethod\" v-show=\"!showSend\">\r\n\t\t\t\t\t<image :src=\"showVoice?imgUrl+'/worker/ic_keyboard_blue.png':imgUrl+'/worker/ic_voice_blue.png'\"\r\n\t\t\t\t\t\tstyle=\"border-radius: 50%;background:#fff;\">\r\n\t\t\t\t\t</image>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<!-- <view class=\"voice_inputing\" v-show=\"inputing\">\r\n\t\t\t\t<image :src=\"imgUrl+'/worker/new/inputing_wave2.gif'\" mode=\"heightFix\"></image>\r\n\t\t\t</view> -->\r\n\t\t\t<!-- 电话按钮 -->\r\n\t\t\t<!-- \t<view v-show=\"currentTabIndex == 1 && !inputHeight && audioSwitch\" class=\"phone_icon\"\r\n\t\t\t\t:style=\"{bottom:inputHeight?inputHeight+60+'px':'128rpx'}\" @click=\"toCall\">\r\n\t\t\t\t<image :src=\"imgUrl+'/worker/new/ic_telephone.png'\" mode=\"widthFix\"></image>\r\n\t\t\t</view> -->\r\n\t\t</view>\r\n\t\t<login :showLogin=\"showLogin\" @cancel=\"cancelLogin\" @closeLogin=\"closeLogin\" @getInfo=\"handleLogin\">\r\n\t\t</login>\r\n\t\t<tabbar current=\"1\" @getTabbarHeight=\"getTabbarHeight\"></tabbar>\r\n\t\t<myModal ref=\"myModal\"></myModal>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport login from \"@/components/login.vue\"\r\n\timport tabbar from \"@/components/worker_tabbar.vue\"\r\n\timport commonData from \"@/common/commonData\"\r\n\timport chat from \"@/components/chat.vue\"\r\n\timport commonMethods from \"@/common/commMethods.js\"\r\n\timport urlSetting from \"@/url_setting\";\r\n\timport {\r\n\t\tmapState,\r\n\t\tmapMutations\r\n\t} from \"vuex\"\r\n\tconst app = getApp()\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tperiod: commonData.periodList,\r\n\t\t\t\tifSingle: app.globalData.scene == 1154 ? true : false,\r\n\t\t\t\tshowLogin: false,\r\n\t\t\t\timgUrl: app.globalData.baseImageUrl,\r\n\t\t\t\tmarginTop: app.globalData.marginTop,\r\n\t\t\t\ttabMargin: app.globalData.tabMargin,\r\n\t\t\t\tlist: [],\r\n\t\t\t\tscrollHeight: 0,\r\n\t\t\t\tcurrentPage: 1,\r\n\t\t\t\tpagination: {},\r\n\t\t\t\ttabbarHeight: 0,\r\n\t\t\t\tsystemHeight: app.globalData.systemHeight,\r\n\t\t\t\tinputHeight: 0,\r\n\t\t\t\tinputing: false,\r\n\t\t\t\tcancelRecord: false,\r\n\t\t\t\tshowVoice: false,\r\n\t\t\t\tvoicePermisson: false,\r\n\t\t\t\tshowSend: false,\r\n\t\t\t\tquestion: \"\",\r\n\t\t\t\thistoryList: [],\r\n\t\t\t\tqaList: [],\r\n\t\t\t\tjobId: \"\",\r\n\t\t\t\taction: \"\",\r\n\t\t\t\tnoMayAsk: false,\r\n\t\t\t\thistoryId: \"\",\r\n\t\t\t\tnewUser: \"\",\r\n\t\t\t\tloadAllHistory: false,\r\n\t\t\t\tstatusBarHeight: app.globalData.statusBarHeight,\r\n\t\t\t\tabnormalClose: false,\r\n\t\t\t\tabnormalErr: false,\r\n\t\t\t\theader: null,\r\n\t\t\t\ttimer: null,\r\n\t\t\t\tresponseStr: \"\",\r\n\t\t\t\tresponCount: 0, //用于第一次接收到信息时，开启打字效果\r\n\t\t\t\tprinTimer: null,\r\n\t\t\t\tcurrentQalength: 0,\r\n\t\t\t\tcurRespone: {\r\n\t\t\t\t\tcontent: \"\",\r\n\t\t\t\t\torigin: \"ai\",\r\n\t\t\t\t\tmsg_type: \"text\",\r\n\t\t\t\t\tcard: null\r\n\t\t\t\t},\r\n\t\t\t\tcurrentProjectDetail: {\r\n\t\t\t\t\tid: \"\",\r\n\t\t\t\t\tname: \"\",\r\n\t\t\t\t\tworker_salary_min: \"\",\r\n\t\t\t\t\tworker_salary_max: \"\",\r\n\t\t\t\t\tworker_salary_type: \"\"\r\n\t\t\t\t},\r\n\t\t\t\tmanager: app.globalData.manager,\r\n\t\t\t\ttouchStartTime: \"\",\r\n\t\t\t\ttouchEndTime: \"\",\r\n\t\t\t\tresponEnd: false,\r\n\t\t\t\tshowChat: false,\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomponents: {\r\n\t\t\ttabbar,\r\n\t\t\tlogin,\r\n\t\t\tchat\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t...mapState([\"answering\", \"connected\", \"connecting\", \"canSend\", \"inChannel\", \"answerContinue\", \"channelQaLen\",\r\n\t\t\t\t\"channelId\", \"channelQaList\", \"location\", \"token\", \"inCall\", \"aiReady\", \"ad_tracking_id\",\r\n\t\t\t\t\"callBackCount\", \"audioSwitch\"\r\n\t\t\t])\r\n\t\t},\r\n\t\tasync onLoad(param) {\r\n\t\t\tconsole.log(\"页面onload\")\r\n\t\t\tthis.closeCansend()\r\n\t\t\tthis.unConnected()\r\n\t\t\tthis.unConnecting()\r\n\t\t\tthis.qaList = []\r\n\t\t\tif (param.id) {\r\n\t\t\t\tthis.jobId = param.id\r\n\t\t\t}\r\n\t\t\tif (this.isLogin()) {\r\n\t\t\t\tthis.creatConnect()\r\n\t\t\t\t// 录音初始化\r\n\t\t\t\tthis.initRecord()\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tasync onReady() {\r\n\t\t\tthis.btnInfo = await commonMethods.getElementInfo(\".input_btn_wrap\")\r\n\t\t\tif (this.btnInfo) {\r\n\t\t\t\tthis.botSafe = app.globalData.systemHeight - this.btnInfo.top\r\n\t\t\t\tthis.scrollHeight = this.btnInfo.top - this.statusBarHeight - 44\r\n\t\t\t}\r\n\t\t\tconsole.log(\"scrollHeight：\", this.scrollHeight)\r\n\t\t},\r\n\t\tonReachBottom() {},\r\n\t\tasync onShow() {\r\n\t\t\tlet _this = this\r\n\t\t\tthis.curRespone = { // 保证是新的对象引用\r\n\t\t\t\tcontent: '',\r\n\t\t\t\torigin: 'ai',\r\n\t\t\t\tmsg_type: 'text',\r\n\t\t\t\tcard: null\r\n\t\t\t}\r\n\t\t\tthis.showChat = true\r\n\t\t\tif (this.ifSingle) {\r\n\t\t\t\treturn\r\n\t\t\t} else {\r\n\t\t\t\tif (this.isLogin()) {\r\n\t\t\t\t\tthis.historyId = 0\r\n\t\t\t\t\tthis.historyList = await this.getHistory()\r\n\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\t_this.$refs.chatRef.toScroll()\r\n\t\t\t\t\t})\r\n\t\t\t\t\tuni.onKeyboardHeightChange(this.listenKeyBoard)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.showLogin = true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonHide() {\r\n\t\t\tapp.globalData.Audio.stop()\r\n\t\t\tapp.globalData.Audio.offPlay()\r\n\t\t\tapp.globalData.Audio.offPause()\r\n\t\t\tapp.globalData.Audio.offStop()\r\n\t\t\tapp.globalData.Audio.offEnded()\r\n\t\t\tuni.offKeyboardHeightChange(this.listenKeyBoard)\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\tthis.showChat = false\r\n\t\t\tthis.close()\r\n\t\t\tuni.hideLoading()\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tquestion(newVal) {\r\n\t\t\t\tconsole.log(\"question newVal：\", newVal)\r\n\t\t\t\tif (!newVal) {\r\n\t\t\t\t\tthis.showSend = false\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.showSend = true\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tresponseStr(newVal) {\r\n\t\t\t\tconsole.log(\"responseStr newVal：\", newVal)\r\n\t\t\t},\r\n\t\t\t// 深度监听list数组的变化\r\n\t\t\tqaList: {\r\n\t\t\t\thandler: function(newVal, oldVal) {\r\n\t\t\t\t\tconsole.log(\"worker_chat 监听qaList：\", newVal)\r\n\t\t\t\t},\r\n\t\t\t\tdeep: true, // 开启深度监听\r\n\t\t\t},\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t...mapMutations([\"openAnswering\", \"closeAnswering\", \"setConnected\", \"unConnected\", \"setConnecting\",\r\n\t\t\t\t\"unConnecting\", \"openCansend\", \"closeCansend\", \"notChannel\", \"isChannel\", \"addChannelQaList\",\r\n\t\t\t\t\"openAnswerContinue\", \"closeAnswerContinue\", \"updateChannelQaList\", \"setChannelId\", \"setLocation\",\r\n\t\t\t\t\"setToken\", \"clearChannelQaList\", \"notInCall\", \"setCallContent\", \"setInterviewCard\", \"setIncallEnroll\",\r\n\t\t\t\t\"setIncallJobId\", \"resetIncallEnroll\", \"closeInterviewCard\",\r\n\t\t\t\t\"setAiReady\", \"resetAiReady\", \"resetCity\", \"setChannelInterviewCard\", \"closeChannelInterviewCard\",\r\n\t\t\t\t\"setJobName\", \"resetJobName\", \"setJobId\", \"resetJobId\", \"setHangUpFirst\", \"setQunCode\",\r\n\t\t\t\t\"setAdTrackingId\", \"setCallBackCount\", \"resetCallBackCount\"\r\n\t\t\t]),\r\n\t\t\tinputBindFocus(e) {\r\n\t\t\t\tif (!this.isLogin()) {\r\n\t\t\t\t\tthis.showLogin = true\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tif (e.detail.height) {\r\n\t\t\t\t\tthis.inputHeight = e.detail.height //这个高度就是软键盘的高度\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonInput(e) {\r\n\t\t\t\tthis.question = e.target.value\r\n\t\t\t},\r\n\t\t\tdoSend(e, text) {\r\n\t\t\t\tif (e.ctrlKey && e.keyCode === 13) {\r\n\t\t\t\t\t//用户点击了ctrl+enter触发\r\n\t\t\t\t\tthis.question += '\\n';\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//用户点击了enter触发    执行一些逻辑方法\r\n\t\t\t\t\tif (e !== undefined) {\r\n\t\t\t\t\t\t//发送消息的方法\r\n\t\t\t\t\t\tthis.sendQuestion();\r\n\t\t\t\t\t\t// 阻止浏览器默认的敲击回车换行的方法\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsendQuestion() {\r\n\t\t\t\tvar _this = this;\r\n\t\t\t\tif (!this.question) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.inputHeight = 0\r\n\t\t\t\t\tvar showData = {\r\n\t\t\t\t\t\tcontent: this.question,\r\n\t\t\t\t\t\torigin: \"customer\",\r\n\t\t\t\t\t\tmsg_type: \"text\"\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.send(this.question, showData, \"\")\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsend(data, param, type) {\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tif (!this.aiReady) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: \"连接中，请稍后\",\r\n\t\t\t\t\t\ticon: \"error\",\r\n\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t// 回答完成后才能发下一条信息\r\n\t\t\t\tconsole.log(\"answering：\", this.answering, \"answerContinue：\", this.answerContinue)\r\n\t\t\t\tif (this.answering || this.answerContinue) {\r\n\t\t\t\t\tthis.$refs.myModal.showMyModal({\r\n\t\t\t\t\t\ttitle: \"目前有正在回复的对话，请稍后重试\",\r\n\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\tconfirmText: \"好的\"\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tif (!this.canSend) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 如果无历史记录显示加载中\r\n\t\t\t\t\tif (this.historyList.length == 0) {\r\n\t\t\t\t\t\tuni.showLoading()\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.question = \"\"\r\n\t\t\t\t\t// 设置非频道\r\n\t\t\t\t\tthis.notChannel()\r\n\t\t\t\t\t// 设置非通话页\r\n\t\t\t\t\tthis.notInCall()\r\n\t\t\t\t\tapp.globalData.socketTask.send({\r\n\t\t\t\t\t\tdata: type == \"voice\" ? data : JSON.stringify({\r\n\t\t\t\t\t\t\t\"content\": data,\r\n\t\t\t\t\t\t\t\"job_channel_id\": \"\",\r\n\t\t\t\t\t\t\t\"job_id\": _this.jobId,\r\n\t\t\t\t\t\t\t\"action_type\": _this.action\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\t_this.jobId = \"\"\r\n\t\t\t\t\t\t\t_this.action = \"\"\r\n\t\t\t\t\t\t\t_this.noMayAsk = false\r\n\t\t\t\t\t\t\t_this.closeInterviewCard()\r\n\t\t\t\t\t\t\t_this.closeChannelInterviewCard()\r\n\t\t\t\t\t\t\t_this.$set(_this, \"question\", \"\")\r\n\t\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t\t\tif (data != \"ping\") {\r\n\t\t\t\t\t\t\t\tif (!_this.cancelRecord) {\r\n\t\t\t\t\t\t\t\t\t_this.openAnswering()\r\n\t\t\t\t\t\t\t\t\tparam.printStr = \"\"\r\n\t\t\t\t\t\t\t\t\t_this.$set(_this.qaList, _this.qaList.length, param)\r\n\t\t\t\t\t\t\t\t\t_this.num++\r\n\t\t\t\t\t\t\t\t\t_this.hold = \"h\" + _this.num\r\n\t\t\t\t\t\t\t\t\t_this.closeCansend()\r\n\t\t\t\t\t\t\t\t\t// _this.placeHolder = \"正在努力思考，请稍后...\"\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\t_this.jobId = \"\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\tgetHistory() {\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tconsole.log(\"获取历史记录\")\r\n\t\t\t\treturn new Promise(resolve => {\r\n\t\t\t\t\tlet url = \"/api/chat/histories?last_message_id=\" + _this.historyId + \"&job_channel_id=\"\r\n\t\t\t\t\t_this.$aiRequest(url, \"\", \"GET\").then(res => {\r\n\t\t\t\t\t\tif (res.code == 0) {\r\n\t\t\t\t\t\t\tif (res.data.length == 0) {\r\n\t\t\t\t\t\t\t\t// 新用户\r\n\t\t\t\t\t\t\t\t_this.newUser = true\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t_this.newUser = false\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlet newArr = res.data.reverse()\r\n\t\t\t\t\t\t\tlet len = res.data.length\r\n\t\t\t\t\t\t\tif (len > 0) {\r\n\t\t\t\t\t\t\t\t_this.historyId = res.data[0].id\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tnewArr = _this.handleList(newArr)\r\n\t\t\t\t\t\t\tresolve(newArr)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\r\n\t\t\t},\r\n\t\t\tgetWorkInfo(id) {\r\n\t\t\t\tlet url = \"/jobs/\" + id\r\n\t\t\t\tthis.$request(url).then(res => {\r\n\t\t\t\t\tif (res.code == 0) {\r\n\t\t\t\t\t\tlet obj = {\r\n\t\t\t\t\t\t\tmsg: res.data.name,\r\n\t\t\t\t\t\t\ttype: \"job\",\r\n\t\t\t\t\t\t\tjobId: id,\r\n\t\t\t\t\t\t\taction: \"\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.sendBtnMsg(obj)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tgetMoreHistory() {\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tif (!this.loadAllHistory) {\r\n\t\t\t\t\tif (!this.historyId) {\r\n\t\t\t\t\t\tif (this.answerContinue || this.answering) {\r\n\t\t\t\t\t\t\tthis.$refs.chatRef.refreshRestore()\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.qaList = []\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tuni.showLoading()\r\n\t\t\t\t\tlet url = \"/api/chat/histories?last_message_id=\" + this.historyId + \"&job_channel_id=\"\r\n\t\t\t\t\tthis.$aiRequest(url).then(res => {\r\n\t\t\t\t\t\tif (res.code == 0) {\r\n\t\t\t\t\t\t\tlet len = res.data.length\r\n\t\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t\t\tthis.$refs.chatRef.scrollToPre()\r\n\t\t\t\t\t\t\tthis.$refs.chatRef.refreshRestore()\r\n\t\t\t\t\t\t\tif (len > 0) {\r\n\t\t\t\t\t\t\t\tlet resArr = res.data.reverse()\r\n\t\t\t\t\t\t\t\tlet newArr = this.handleList(resArr)\r\n\t\t\t\t\t\t\t\tthis.historyList = newArr.concat(this.historyList)\r\n\t\t\t\t\t\t\t\tthis.scrollStr = \"his\" + res.data[len - 1].id\r\n\t\t\t\t\t\t\t\tthis.historyId = res.data[0].id\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.loadAllHistory = true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.$refs.chatRef.refreshRestore()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: \"已加载全部\",\r\n\t\t\t\t\t\ticon: \"none\",\r\n\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t})\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t_this.$refs.chatRef.refreshRestore()\r\n\t\t\t\t\t}, 500)\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\t// 给聊天记录添加字段\r\n\t\t\thandleList(arr) {\r\n\t\t\t\tlet len = arr.length\r\n\t\t\t\tfor (let i = 0; i < len; i++) {\r\n\t\t\t\t\tif (arr[i].msg_type == \"voice\") {\r\n\t\t\t\t\t\t// 语音记录，添加是否播放状态,默认为false\r\n\t\t\t\t\t\tarr[i].voice.anmitionPlay = false\r\n\t\t\t\t\t\tarr[i].showTranlate = false\r\n\t\t\t\t\t\tarr[i].showTranIcon = false\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn arr\r\n\t\t\t},\r\n\r\n\t\t\tmakePhoneCall() {\r\n\t\t\t\tthis.$store.dispatch('makePhoneCall')\r\n\t\t\t},\r\n\t\t\tcloseLogin() {\r\n\t\t\t\tthis.showLogin = false\r\n\t\t\t},\r\n\t\t\tcancelLogin() {\r\n\t\t\t\tthis.closeLogin()\r\n\t\t\t\tuni.switchTab({\r\n\t\t\t\t\turl: \"/pages/worker_index/worker_index\"\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tasync handleLogin() {\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tthis.historyId = 0\r\n\t\t\t\tthis.historyList = await this.getHistory()\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t_this.$refs.chatRef.toScroll()\r\n\t\t\t\t})\r\n\t\t\t\tthis.creatConnect()\r\n\t\t\t},\r\n\t\t\tgetTabbarHeight(e) {\r\n\t\t\t\tthis.tabbarHeight = e\r\n\t\t\t},\r\n\t\t\tasync creatConnect() {\r\n\t\t\t\tvar _this = this;\r\n\t\t\t\tthis.header = {\r\n\t\t\t\t\t'content-type': 'application/json',\r\n\t\t\t\t\t\"app-id\": urlSetting.urls.appid,\r\n\t\t\t\t\t\"open-id\": uni.getStorageSync(\"openid\") ? uni.getStorageSync(\"openid\") : \"\",\r\n\t\t\t\t\t\"Authorization\": \"bearer \" + uni.getStorageSync(\"token\"),\r\n\t\t\t\t}\r\n\t\t\t\tthis.abnormalClose = false\r\n\t\t\t\tthis.abnormalErr = false\r\n\t\t\t\t// uni.showLoading({\r\n\t\t\t\t// \ttitle: \"正在链接客服\"\r\n\t\t\t\t// })\r\n\t\t\t\tif (app.globalData.socketTask) {\r\n\t\t\t\t\t// 关闭之前的链接\r\n\t\t\t\t\t// uni.showToast({\r\n\t\t\t\t\t// \ttitle: \"关闭之前的socketTask\"\r\n\t\t\t\t\t// })\r\n\t\t\t\t\tawait this.close()\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log(\"connected：\", this.connected)\r\n\t\t\t\tif (this.connected || this.connecting) {\r\n\t\t\t\t\t// uni.showToast({\r\n\t\t\t\t\t// \ttitle: \"已连接或连接中\"\r\n\t\t\t\t\t// })\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t\t// 两个链接状态都为false才开始创建链接\r\n\t\t\t\tthis.setConnecting()\r\n\t\t\t\tlet res = await this.connectWebsocket(this.header)\r\n\t\t\t\tif (res.errMsg == \"connectSocket:ok\") {\r\n\t\t\t\t\tthis.initWebsocket()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tconnectWebsocket(header) {\r\n\t\t\t\t// uni.showToast({\r\n\t\t\t\t// \ttitle: \"创建socketTask链接\"\r\n\t\t\t\t// })\r\n\t\t\t\tlet _this = this\r\n\t\t\t\treturn new Promise((resolve) => {\r\n\t\t\t\t\tapp.globalData.socketTask = uni.connectSocket({\r\n\t\t\t\t\t\turl: app.globalData.wssUrl,\r\n\t\t\t\t\t\theader: header,\r\n\t\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\t// uni.showToast({\r\n\t\t\t\t\t\t\t// \ttitle: \"socketTask创建成功\"\r\n\t\t\t\t\t\t\t// })\r\n\t\t\t\t\t\t\tresolve(res)\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\tconsole.log(\"err:\", err)\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\ttitle: err.errMsg,\r\n\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 间隔一定时间判断用户是否没有输入\r\n\t\t\tnoInput() {\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tthis.timer = setInterval(function() {\r\n\t\t\t\t\tlet data = \"[PING]\"\r\n\t\t\t\t\t_this.send(data, \"\", \"\")\r\n\t\t\t\t}, 10000)\r\n\t\t\t},\r\n\t\t\tresetData() {\r\n\t\t\t\tthis.cancelRecord = false\r\n\t\t\t\tthis.curRespone = {\r\n\t\t\t\t\tcontent: \"\",\r\n\t\t\t\t\torigin: \"ai\",\r\n\t\t\t\t\tmsg_type: \"text\",\r\n\t\t\t\t\tcard: null\r\n\t\t\t\t}\r\n\t\t\t\tthis.responCount = 0\r\n\t\t\t\tthis.responseStr = \"\"\r\n\t\t\t\tthis.responEnd = false\r\n\t\t\t\t// this.notRespEnd()\r\n\t\t\t},\r\n\t\t\tinitWebsocket() {\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tapp.globalData.socketTask.onOpen((res) => {\r\n\t\t\t\t\tthis.abnormalClose = false\r\n\t\t\t\t\tthis.abnormalErr = false\r\n\t\t\t\t\tthis.unConnecting()\r\n\t\t\t\t\tthis.setConnected()\r\n\t\t\t\t\tthis.closeAnswering()\r\n\t\t\t\t\tthis.closeAnswerContinue()\r\n\t\t\t\t\tthis.openCansend()\r\n\t\t\t\t\tthis.setAiReady()\r\n\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\tif (this.jobId) {\r\n\t\t\t\t\t\tthis.getWorkInfo(this.jobId)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (_this.currentProjectDetail.id && !_this.answerContinue) {\r\n\t\t\t\t\t\t_this.showProPop = true\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconsole.log('已成功建立链接onOpen', res);\r\n\t\t\t\t})\r\n\t\t\t\tapp.globalData.socketTask.onError((err) => {\r\n\t\t\t\t\tthis.abnormalErr = true\r\n\t\t\t\t\tapp.globalData.socketTask = null\r\n\t\t\t\t\tclearInterval(_this.timer)\r\n\t\t\t\t\tthis.closeAnswering()\r\n\t\t\t\t\tthis.closeAnswerContinue()\r\n\t\t\t\t\tthis.unConnected()\r\n\t\t\t\t\tthis.unConnecting()\r\n\t\t\t\t\tthis.resetAiReady()\r\n\t\t\t\t\t// if (this.answering || this.answerContinue) {\r\n\t\t\t\t\t// \tthis.handleConnectErr()\r\n\t\t\t\t\t// }\r\n\t\t\t\t\tif (!this.abnormalClose) {\r\n\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t_this.creatConnect()\r\n\t\t\t\t\t\t}, 2000)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t})\r\n\t\t\t\tapp.globalData.socketTask.onMessage((res) => {\r\n\t\t\t\t\tthis.closeAnswering()\r\n\t\t\t\t\t// this.closeAnswerContinue()\r\n\t\t\t\t\t_this.openAnswerContinue()\r\n\t\t\t\t\t// _this.closeAnswering()\r\n\t\t\t\t\tlet respData = JSON.parse(res.data)\r\n\t\t\t\t\tconsole.log(\"websocket返回：\", respData)\r\n\t\t\t\t\tif (respData.type == \"QCODE\") {\r\n\t\t\t\t\t\t// 推送客服微信\r\n\t\t\t\t\t\tlet card = {\r\n\t\t\t\t\t\t\ttype: \"QCODE\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t_this.curRespone.card = JSON.parse(JSON.stringify(card))\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (respData.type == \"score_not_enough\") {\r\n\t\t\t\t\t\t// 推送充值积分卡片\r\n\t\t\t\t\t\tlet card = {\r\n\t\t\t\t\t\t\ttype: \"score_not_enough\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t_this.setJobName(respData.job_name)\r\n\t\t\t\t\t\t_this.curRespone.card = JSON.parse(JSON.stringify(card))\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (respData.type == \"applied\") {\r\n\t\t\t\t\t\t// 推送充值积分卡片\r\n\t\t\t\t\t\tlet card = {\r\n\t\t\t\t\t\t\ttype: \"applied\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t_this.setJobName(respData.job_name)\r\n\t\t\t\t\t\t_this.setJobId(respData.job_id)\r\n\t\t\t\t\t\t_this.curRespone.card = JSON.parse(JSON.stringify(card))\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (respData.message != \"[DONE]\") {\r\n\t\t\t\t\t\t_this.responCount++\r\n\t\t\t\t\t\t_this.responseStr += respData.message\r\n\t\t\t\t\t\tif (_this.responCount == 1) {\r\n\t\t\t\t\t\t\t_this.currentQalength = _this.qaList.length\r\n\t\t\t\t\t\t\t_this.printResponse()\r\n\t\t\t\t\t\t\tif (respData.type == \"QCODE\") {\r\n\t\t\t\t\t\t\t\t_this.getQrcode(respData.job_id)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t_this.responEnd = true\r\n\t\t\t\t\t\t// _this.setRespEnd()\r\n\t\t\t\t\t\tconsole.log(\"RespEnd：\", _this.responEnd)\r\n\t\t\t\t\t\tif (respData.need_mayask) {\r\n\t\t\t\t\t\t\t_this.getMayAsk()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tapp.globalData.socketTask.onClose(async (res) => {\r\n\t\t\t\t\tthis.abnormalClose = true\r\n\t\t\t\t\t// uni.hideLoading()\r\n\t\t\t\t\tconsole.log('onClose', res)\r\n\t\t\t\t\tapp.globalData.socketTask = null\r\n\t\t\t\t\tthis.unConnected()\r\n\t\t\t\t\tthis.unConnecting()\r\n\t\t\t\t\tthis.resetAiReady()\r\n\t\t\t\t\tthis.qaList = []\r\n\t\t\t\t\tthis.historyId = 0\r\n\t\t\t\t\tthis.historyList = await this.getHistory()\r\n\t\t\t\t\t// if (this.answering || this.answerContinue) {\r\n\t\t\t\t\t// \tthis.handleConnectErr()\r\n\t\t\t\t\t// }\r\n\t\t\t\t\tclearInterval(this.timer)\r\n\t\t\t\t\tif (!this.abnormalErr) {\r\n\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t_this.creatConnect()\r\n\t\t\t\t\t\t}, 2000)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\thandleConnectErr() {\r\n\t\t\t\t// 当链接断开或者出错时提示用户重新发送\r\n\t\t\t\tlet len = this.qaList.length\r\n\t\t\t\tif ((len > 0) && (this.qaList[len - 1].origin == \"customer\")) {\r\n\t\t\t\t\tthis.closeAnswering()\r\n\t\t\t\t\tthis.openCansend()\r\n\t\t\t\t\tthis.closeAnswerContinue()\r\n\t\t\t\t\tthis.resetData()\r\n\t\t\t\t\tclearInterval(this.prinTimer)\r\n\t\t\t\t\t// 上一条是用户发送的数据时\r\n\t\t\t\t\tlet data = {\r\n\t\t\t\t\t\tcontent: \"抱歉！刚才打了个盹儿，没理解到您的意思，请重新发送一下您的问题。\",\r\n\t\t\t\t\t\tprintStr: \"\",\r\n\t\t\t\t\t\tmsg_type: \"text\",\r\n\t\t\t\t\t\torigin: \"ai\",\r\n\t\t\t\t\t\tjobs: [],\r\n\t\t\t\t\t\tmay_ask: []\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.qaList.push(data)\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\tgetQrcode(id) {\r\n\t\t\t\tif (!id) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tlet url = \"/worker/project/\" + id + \"/wework/external/group/qrcode\"\r\n\t\t\t\tthis.$request(url).then(res => {\r\n\t\t\t\t\tif (res.code == 0) {\r\n\t\t\t\t\t\tthis.setQunCode(res.data.qrcode_url)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tasync sendBtnMsg(obj) {\r\n\t\t\t\tconsole.log(\"sendBtnMsg被调用：\", obj)\r\n\t\t\t\tlet _this = this\r\n\t\t\t\t// if (obj.job_id) {\r\n\t\t\t\t// \tthis.currentProjectDetail.id = obj.job_id\r\n\t\t\t\t// \tthis.currentProjectDetail.name = obj.name\r\n\t\t\t\t// }\r\n\t\t\t\tif (!this.isLogin()) {\r\n\t\t\t\t\tthis.showLogin = true\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tif (!this.aiReady) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: \"连接中，请稍后\",\r\n\t\t\t\t\t\ticon: \"error\",\r\n\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t// 如果正在回答问题\r\n\t\t\t\tif (this.answerContinue) {\r\n\t\t\t\t\t// uni.showToast({\r\n\t\t\t\t\t// \ttitle: \"回答中，请稍后\",\r\n\t\t\t\t\t// \ticon: \"error\",\r\n\t\t\t\t\t// \tduration: 2000\r\n\t\t\t\t\t// })\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t// this.closeProPop()\r\n\t\t\t\tthis.jobId = obj.job_id\r\n\t\t\t\tthis.action = obj.action\r\n\t\t\t\tif (obj.type == \"job\") {\r\n\t\t\t\t\t// 词语润色\r\n\t\t\t\t\tlet strArr = []\r\n\t\t\t\t\tstrArr.push(\"请介绍一下\" + obj.msg)\r\n\t\t\t\t\tstrArr.push(\"我对\" + obj.msg + \"感兴趣，可以介绍一下吗？\")\r\n\t\t\t\t\tstrArr.push(obj.msg + \"的工作内容是什么呢？福利待遇怎么样？\")\r\n\t\t\t\t\tstrArr.push(obj.msg + \"这个工作看着还不错，请为我介绍下吧\")\r\n\t\t\t\t\tstrArr.push(obj.msg + \"这个工作的详细信息可以说一下吗？\")\r\n\t\t\t\t\tlet random = Math.floor(Math.random() * strArr.length)\r\n\t\t\t\t\tthis.question = strArr[random]\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.question = obj.msg\r\n\t\t\t\t}\r\n\t\t\t\tthis.sendQuestion()\r\n\r\n\t\t\t},\r\n\t\t\tclose() {\r\n\t\t\t\treturn new Promise((resolve) => {\r\n\t\t\t\t\tif (app.globalData.socketTask) {\r\n\t\t\t\t\t\tapp.globalData.socketTask.close()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tprintResponse() {\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tlet index = 0\r\n\t\t\t\tlet str = \"\"\r\n\t\t\t\tlet noOutCount = 0\r\n\t\t\t\tthis.prinTimer = setInterval(function() {\r\n\t\t\t\t\tlet len = _this.responseStr.length\r\n\t\t\t\t\tif (index < len) {\r\n\t\t\t\t\t\tstr += _this.responseStr[index]\r\n\t\t\t\t\t\t_this.$set(_this.curRespone, \"content\", str)\r\n\t\t\t\t\t\tlet newItem = {\r\n\t\t\t\t\t\t\t..._this.curRespone\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t_this.$set(_this.qaList, _this.currentQalength, newItem)\r\n\t\t\t\t\t\tindex++\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (_this.responEnd) {\r\n\t\t\t\t\t\t\tif (_this.curRespone.card) {\r\n\t\t\t\t\t\t\t\t_this.curRespone.card.showCard = true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tclearInterval(_this.prinTimer)\r\n\t\t\t\t\t\t\tconsole.log(\"打印完之后 qaList\", _this.qaList)\r\n\t\t\t\t\t\t\t_this.openCansend()\r\n\t\t\t\t\t\t\t_this.resetData()\r\n\t\t\t\t\t\t\t_this.closeAnswerContinue()\r\n\t\t\t\t\t\t\tif (_this.jobId) {\r\n\t\t\t\t\t\t\t\t_this.getWorkInfo(_this.jobId)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 30)\r\n\r\n\t\t\t},\r\n\t\t\tgetMayAsk() {\r\n\r\n\t\t\t\tlet data = {\r\n\t\t\t\t\t\"job_channel_id\": this.channelId\r\n\t\t\t\t}\r\n\t\t\t\tlet index = 0\r\n\t\t\t\tlet obj = {}\r\n\t\t\t\tconsole.log(\"执行了mayask\")\r\n\t\t\t\tthis.$aiRequest(\"/api/chat/suggested-questions\", data, \"POST\").then(res => {\r\n\t\t\t\t\tif (this.channelId) {\r\n\t\t\t\t\t\t// 频道内\r\n\t\t\t\t\t\tindex = this.channelQaList.length - 1\r\n\t\t\t\t\t\tobj = this.channelQaList[index]\r\n\t\t\t\t\t\tobj.may_ask = res.questions\r\n\t\t\t\t\t\tthis.updateChannelQaList(obj)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tindex = this.qaList.length - 1\r\n\t\t\t\t\t\tobj = {\r\n\t\t\t\t\t\t\t...(this.qaList[index])\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tobj.may_ask = res.questions\r\n\t\t\t\t\t\tthis.$set(this.qaList, index, obj)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tlistenKeyBoard(res) {\r\n\t\t\t\tif (res.height == 0) {\r\n\t\t\t\t\tthis.inputHeight = 0\r\n\t\t\t\t\tthis.scrollHeight = this.btnInfo.top - this.statusBarHeight - 44\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.scrollHeight = app.globalData.systemHeight - this.statusBarHeight - 44 - res\r\n\t\t\t\t\t\t.height -\r\n\t\t\t\t\t\tthis.btnInfo.height - 10\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tinitRecord() {\r\n\t\t\t\t//录音开始事件\r\n\t\t\t\tthis.manager.onStart(e => {\r\n\t\t\t\t\tthis.inputing = true\r\n\t\t\t\t});\r\n\t\t\t\t//录音结束事件\r\n\t\t\t\tthis.manager.onStop(res => {\r\n\t\t\t\t\tlet _this = this\r\n\t\t\t\t\tthis.inputing = false\r\n\t\t\t\t\tif ((this.touchEndTime - this.touchStartTime) > 1000) {\r\n\t\t\t\t\t\tthis.handleRecorder(res);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: \"长按时间过短\",\r\n\t\t\t\t\t\t\ticon: \"error\"\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t});\r\n\t\t\t\tthis.manager.onError(res => {\r\n\t\t\t\t\tlet _this = this\r\n\t\t\t\t\tthis.inputing = false\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 处理录音数据\r\n\t\t\thandleRecorder({\r\n\t\t\t\ttempFilePath,\r\n\t\t\t\tduration\r\n\t\t\t}) {\r\n\t\t\t\tthis.inputing = false;\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tif (duration < 600) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: \"说话时间过短\",\r\n\t\t\t\t\t\ticon: \"error\",\r\n\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!this.cancelRecord) {\r\n\t\t\t\t\twx.getFileSystemManager().readFile({\r\n\t\t\t\t\t\tfilePath: tempFilePath,\r\n\t\t\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\t\t\t// res.data是录音文件的二进制数据\r\n\t\t\t\t\t\t\tconst binaryData = res.data;\r\n\t\t\t\t\t\t\tlet midata = new Uint8Array(binaryData)\r\n\t\t\t\t\t\t\tlet time = new Date().getTime()\r\n\t\t\t\t\t\t\tlet id = uni.getStorageSync(\"openid\") + time\r\n\t\t\t\t\t\t\t// let encoder = new TextEncoder();\r\n\t\t\t\t\t\t\t// let binaryId = encoder.encode(id + \"@@@\")\r\n\t\t\t\t\t\t\tlet binaryId = _this.stringToUint8Array(id + \"@@@@@@\" + _this.jobId + \"@@@@@@\")\r\n\t\t\t\t\t\t\t// 输出拼接后的 Uint8Array\r\n\t\t\t\t\t\t\t// 计算总长度\r\n\t\t\t\t\t\t\tconst totalLength = binaryId.length + midata.length;\r\n\t\t\t\t\t\t\t// 创建一个新的 Uint8Array，长度为所有数组的总和\r\n\t\t\t\t\t\t\tlet mergedArray = new Uint8Array(totalLength);\r\n\t\t\t\t\t\t\t// 使用 set 方法将每个 Uint8Array 的数据填充到新的 Uint8Array 中\r\n\t\t\t\t\t\t\tlet offset = 0;\r\n\t\t\t\t\t\t\tmergedArray.set(binaryId, offset);\r\n\t\t\t\t\t\t\toffset += binaryId.length;\r\n\r\n\t\t\t\t\t\t\tmergedArray.set(midata, offset);\r\n\t\t\t\t\t\t\t// offset += data.length;\r\n\t\t\t\t\t\t\tlet showData = {\r\n\t\t\t\t\t\t\t\tid: id,\r\n\t\t\t\t\t\t\t\tcontent: \"\",\r\n\t\t\t\t\t\t\t\torigin: \"customer\",\r\n\t\t\t\t\t\t\t\tmsg_type: \"voice\",\r\n\t\t\t\t\t\t\t\tvoice: {\r\n\t\t\t\t\t\t\t\t\tmedia: {\r\n\t\t\t\t\t\t\t\t\t\tkey: \"\",\r\n\t\t\t\t\t\t\t\t\t\turl: tempFilePath\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tsecond: duration / 1000,\r\n\t\t\t\t\t\t\t\t\tanmitionPlay: false\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tshowTranIcon: false,\r\n\t\t\t\t\t\t\t\tshowTranlate: false,\r\n\t\t\t\t\t\t\t\tshowTransing: false\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t_this.send(mergedArray.buffer, showData, \"voice\")\r\n\t\t\t\t\t\t\t// 接下来你可以对binaryData进行需要的操作\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail: function(error) {\r\n\t\t\t\t\t\t\tconsole.error('读取文件失败：', error);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.cancelRecord = false\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\t// this.canSend && this.sendMsg(params);\r\n\t\t\t},\r\n\t\t\tstringToUint8Array(str) {\r\n\t\t\t\tconst utf8 = unescape(encodeURIComponent(str)); // 将字符串编码为 UTF-8\r\n\t\t\t\tconst len = utf8.length;\r\n\t\t\t\tconst arr = new Uint8Array(len);\r\n\t\t\t\tfor (let i = 0; i < len; i++) {\r\n\t\t\t\t\tarr[i] = utf8.charCodeAt(i);\r\n\t\t\t\t}\r\n\t\t\t\treturn arr;\r\n\t\t\t},\r\n\t\t\tstartRecord(e) {\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tif (!this.isLogin()) {\r\n\t\t\t\t\tthis.showLogin = true\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tif (!this.aiReady) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: \"连接中，请稍后\",\r\n\t\t\t\t\t\ticon: \"error\",\r\n\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tif (!this.canSend) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: \"正在回答请稍后\",\r\n\t\t\t\t\t\ticon: \"error\",\r\n\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t// 先判断是否是可发送状态\r\n\t\t\t\tif (!this.canSend) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t_this.touchStartTime = e.timeStamp\r\n\t\t\t\t_this.$refs.chatRef.stopCurAudio()\r\n\t\t\t\tuni.vibrateShort({\r\n\t\t\t\t\tsuccess: function() {}\r\n\t\t\t\t});\r\n\t\t\t\t_this.cancelRecord = false\r\n\t\t\t\t_this.manager.start({\r\n\t\t\t\t\tduration: 60000,\r\n\t\t\t\t\tlang: \"zh_CN\"\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tgetSetting() {\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tuni.getSetting({\r\n\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\tif (!res.authSetting['scope.record']) {\r\n\t\t\t\t\t\t\t_this.voicePermisson = false\r\n\t\t\t\t\t\t\t// 可以在这里引导用户去设置中开启权限\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t_this.voicePermisson = true\r\n\t\t\t\t\t\t\t// 用户已授权，可以继续进行后续操作\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail(err) {}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tstopRecord(e) {\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tthis.inputing = false\r\n\t\t\t\tthis.touchEndTime = e.timeStamp\r\n\t\t\t\tif ((this.touchEndTime - this.touchStartTime) > 1000) {\r\n\t\t\t\t\tthis.manager.stop()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t_this.manager.stop()\r\n\t\t\t\t\t}, 1000)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t//录音被打断\r\n\t\t\tcancelVoice(e) {\r\n\t\t\t\tthis.inputing = false\r\n\t\t\t\t// this.canSend = false;\r\n\t\t\t\tthis.manager.stop();\r\n\t\t\t},\r\n\t\t\topenSetting() {\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tlet ifAuth = uni.getStorageSync(\"voiceAuth\")\r\n\t\t\t\tif (ifAuth) {\r\n\t\t\t\t\tuni.openSetting({\r\n\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\tif (res.authSetting['scope.record']) {\r\n\t\t\t\t\t\t\t\t_this.voicePermisson = true\r\n\t\t\t\t\t\t\t\t_this.showVoice = true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail(openErr) {\r\n\t\t\t\t\t\t\t_this.voicePermisson = false\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.authorize({\r\n\t\t\t\t\t\tscope: 'scope.record',\r\n\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\t_this.voicePermisson = true\r\n\t\t\t\t\t\t\t_this.showVoice = true\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\t// 弹出麦克风授权\r\n\t\t\t\t\t\t\t_this.voicePermisson = false\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcomplete() {\r\n\t\t\t\t\t\t\tuni.setStorageSync(\"voiceAuth\", true)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tchangeChatMethod() {\r\n\t\t\t\tif (!this.showVoice) {\r\n\t\t\t\t\t// 当前是文字输入，要切换到语音输入\r\n\t\t\t\t\t// 首先获取设置，看是否有语音授权\r\n\t\t\t\t\tif (!this.voicePermisson) {\r\n\t\t\t\t\t\tthis.openSetting()\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.showVoice = true\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.showVoice = false\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\thandleTouchMove(e) {\r\n\t\t\t\tif (!this.canSend) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tlet exp = e.touches[e.touches.length - 1].clientY < this.btnInfo.top\r\n\t\t\t\tif (exp) {\r\n\t\t\t\t\tthis.cancelRecord = true\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.cancelRecord = false\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsetScrollHeight() {\r\n\t\t\t\tthis.scrollHeight = this.btnInfo.top - this.statusBarHeight - 44\r\n\t\t\t},\r\n\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t::v-deep {\r\n\t\t.u-navbar--fixed {\r\n\t\t\tbackground: linear-gradient(180deg, #9EC2FF 0%, #FFFFFF 100%);\r\n\t\t}\r\n\r\n\t\t.u-navbar__content__left {\r\n\t\t\tdisplay: none !important;\r\n\t\t}\r\n\r\n\t\t.u-tabs__wrapper__nav__item {\r\n\t\t\tpadding: 0 !important;\r\n\t\t}\r\n\t}\r\n\r\n\t.content {\r\n\t\twidth: 100%;\r\n\t\tleft: 0;\r\n\t\ttop: 0;\r\n\t\tposition: fixed;\r\n\t\theight: 100vh;\r\n\t\tbackground: #F3F3F5;\r\n\t}\r\n\r\n\t.fenge {\r\n\t\tmargin-top: 20rpx;\r\n\r\n\t\t.fgline {\r\n\t\t\twidth: calc(50% - 110rpx);\r\n\t\t\tborder-top: 2rpx solid #C2D3E5;\r\n\t\t}\r\n\r\n\t\t.text {\r\n\t\t\twidth: 200rpx;\r\n\t\t\tfont-weight: 400;\r\n\t\t\tfont-size: 26rpx;\r\n\t\t\tcolor: #93A4B7;\r\n\t\t\ttext-align: center;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t.input_btn_wrap {\r\n\t\twidth: calc(100% - 56rpx);\r\n\t\tposition: fixed;\r\n\t\tleft: 28rpx;\r\n\t\tbottom: 24rpx;\r\n\t\theight: 100rpx;\r\n\t\tbox-sizing: border-box;\r\n\t\tbackground: #FFFFFF;\r\n\t\tbox-shadow: 0rpx 0rpx 4rpx 0rpx rgba(0, 0, 0, 0.1);\r\n\t\tborder-radius: 63rpx;\r\n\t\tz-index: 10;\r\n\r\n\t\t.phone_icon {\r\n\t\t\tposition: absolute;\r\n\t\t\tright: 0;\r\n\t\t\tfont-size: 0;\r\n\r\n\t\t\timage {\r\n\t\t\t\twidth: 77rpx;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.voice_inputing {\r\n\t\t\ttext-align: center;\r\n\r\n\t\t\timage {\r\n\t\t\t\theight: 100rpx;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.btns_wrap {\r\n\t\t\tposition: absolute;\r\n\t\t\tbottom: calc(100% + 10px);\r\n\t\t\tleft: 0;\r\n\r\n\t\t\t.btn_item {\r\n\t\t\t\twidth: 180rpx;\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\theight: 30px;\r\n\t\t\t\tline-height: 30px;\r\n\t\t\t\tbackground: #F7F8FA;\r\n\t\t\t\tborder-radius: 63rpx;\r\n\t\t\t\tfont-size: 27rpx;\r\n\t\t\t\tcolor: #7D8488;\r\n\t\t\t\tmargin-right: 15rpx;\r\n\t\t\t\tjustify-content: center;\r\n\r\n\t\t\t\timage {\r\n\t\t\t\t\twidth: 28rpx;\r\n\t\t\t\t\tmargin-right: 6rpx;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t&.upper {\r\n\t\t\t// position: fixed;\r\n\t\t\t// width: calc(100% - 80rpx);\r\n\t\t\t// left: 40rpx;\r\n\t\t\t// z-index: 105;\r\n\t\t\t// background: #fff;\r\n\t\t\t// border: 1rpx solid #216FF9;\r\n\r\n\t\t\t// .btns_wrap {\r\n\t\t\t// \t.btn_item {\r\n\t\t\t// \t\tbackground: #F7F8FA;\r\n\t\t\t// \t\tcolor: #7D8488;\r\n\t\t\t// \t\t// border: 1rpx solid #216FF9;\r\n\t\t\t// \t}\r\n\t\t\t// }\r\n\t\t}\r\n\r\n\t\t.voice_btn_wrap {\r\n\t\t\theight: 100rpx;\r\n\t\t\tline-height: 100rpx;\r\n\t\t\ttext-align: center;\r\n\t\t}\r\n\r\n\t\t.input_box {\r\n\t\t\tinput {\r\n\t\t\t\theight: 100rpx;\r\n\t\t\t\tline-height: 100rpx;\r\n\t\t\t\tfont-size: 30rpx;\r\n\t\t\t\tcolor: #0F2A4F;\r\n\t\t\t\tposition: relative;\r\n\t\t\t}\r\n\r\n\r\n\t\t\tpadding: 0 75rpx 0 100rpx;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t}\r\n\r\n\t\t.fl_icon {\r\n\t\t\tposition: absolute;\r\n\t\t\ttop: 8rpx;\r\n\t\t\tleft: 11rpx;\r\n\r\n\t\t\timage {\r\n\t\t\t\twidth: 86rpx;\r\n\t\t\t\theight: 86rpx;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.func_icon {\r\n\t\t\tposition: absolute;\r\n\t\t\tpadding: 0 15rpx 0 30rpx;\r\n\t\t\theight: 100rpx;\r\n\t\t\ttop: 0rpx;\r\n\t\t\tright: 0rpx;\r\n\t\t\tz-index: 100;\r\n\r\n\t\t\timage {\r\n\t\t\t\twidth: 60rpx;\r\n\t\t\t\theight: 60rpx;\r\n\t\t\t\tmargin-top: 20rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</style>","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&id=f8b49f40&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&id=f8b49f40&lang=scss&scoped=true&\""],"sourceRoot":""}