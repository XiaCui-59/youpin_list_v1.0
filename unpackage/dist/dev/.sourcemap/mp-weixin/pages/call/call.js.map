{"version":3,"sources":["uni-app:///main.js","webpack:///E:/项目文件/发薪平台/fengling3.0_250327/pages/call/call.vue?312d","webpack:///E:/项目文件/发薪平台/fengling3.0_250327/pages/call/call.vue?5bbb","webpack:///E:/项目文件/发薪平台/fengling3.0_250327/pages/call/call.vue?a3d6","webpack:///E:/项目文件/发薪平台/fengling3.0_250327/pages/call/call.vue?fdd1","uni-app:///pages/call/call.vue","webpack:///E:/项目文件/发薪平台/fengling3.0_250327/pages/call/call.vue?ed64","webpack:///E:/项目文件/发薪平台/fengling3.0_250327/pages/call/call.vue?7c7a"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","imgUrl","inputStatus","manager","lowVoiceCount","audioCtx","currentPlayIndex","source","aiSpeeking","index","result","tipsText","closeStatus","highVoiceCount","longTimeNoInput","action","onLoad","onUnload","watch","computed","methods","close","uni","interrupt","resetData","startRecord","format","sampleRate","numberOfChannels","encodeBitRate","frameSize","duration","initRecord","console","_this","frameBuffer","res","uint16Array","squareSum","userEnter","mergedArray","offset","handleRecorder","tempFilePath","filePath","success","fail","stringToUint8Array","arr","sendMessage","url","enableChunked","header","responseType","method","requestTask","play"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,aAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAiH;AACjH;AACwD;AACL;AACc;;;AAGjE;AACsK;AACtK,gBAAgB,6KAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,+EAAM;AACR,EAAE,wFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAgnB,CAAgB,8mBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;ACqCpoB;AAEA;AAGA;AAAA;AAJA;AAKA;AAAA,eACA;EACAC;IACA;MACAC;MACAC;MAAA;MACAC;MACAC;MAAA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MAAA;MACAC;MAAA;MACAC;IACA;EACA;EACAC;IAAA;IAAA;MAAA;QAAA;UAAA;YAAA;cACA;cACA;cACA;cACA;cACA;cACA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EACA;EACAC;IACA;EACA;EACAC;IACAd;MACA;QACA;QACA;UACA;UACA;QACA;QACA;QACA;MACA;IACA;IACAS;MACA;QACA;QACA;MACA;IACA;IACAX;MACA;QACA;QACA;MACA;IACA;EACA;EACAiB,4BACA,uHACA,kDACA,EACA;EACAC;IACAC;MACA;MACA;MACA;MACA;QACA;QACA;QACA;QACA;MACA;MACAC;IACA;IACAC;MACA;QACA;QACA;MACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IACAC;MACA;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;IACA;IACAC;MAAA;MACA;MACA;QACAC;QACA;MACA;MACA;MACA;QACA;QACAA;QACAC;QACA;QACA;UACA;QACA;MACA;MACA;QACA;QACA;QACA;QACAD;MACA;MACA;QACA;QACA,IACAE,cACAC,IADAD;QAEA;QACA;QACA;QACAE;UACAC;QACA;QACA;QACA;QACA;QACAL;QACA;UACAC;QACA;UACAA;UACAA;QACA;MACA;IACA;IACAK;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACAC;MACAC;MACAD;MACAN;IACA;IACA;IACAQ,8CAGA;MAAA,IAFAC;QACAZ;MAEA;MACA;MACApC;QACAiD;QACAC;UACA;UACA;UACA;UACA;UACA;UACA,qFACA9B;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACAyB;UACAC;UACAD;UACAN;QACA;QACAY;UACAb;QACA;MACA;IACA;IACAc;MACA;MACA;MACA;MACA;QACAC;MACA;MACA;IACA;IACAC;MACA;MACA;QACAC;QACAC;QACAC;UACA;UACA;UACA;UACA;UACA;UACA;QACA;QACAC;QACAC;QACAtD;QACA6C;UACAZ;QACA;QACAa;UACAb;UACA;QACA;MACA;;MACAsB;QACAtB;QACAC;QACAA;UACAA;UACAD;UACAC;UACA;YACAA;UACA;QACA;UACAD;QACA;MACA;IACA;IACAuB;MACA;MACA;MACAvB;MACA;MACA1B;MACAA;MACA;QACA2B;QACAA;QACAA;QACAA;QACA3B;QACA0B;QACAA;MACA;MACA1B;MACAA;QACA0B;QACA;UACAC;UACAA;QACA;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;AC5TA;AAAA;AAAA;AAAA;AAAuqC,CAAgB,6lCAAG,EAAC,C;;;;;;;;;;;ACA3rC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/call/call.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/call/call.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./call.vue?vue&type=template&id=63abc074&\"\nvar renderjs\nimport script from \"./call.vue?vue&type=script&lang=js&\"\nexport * from \"./call.vue?vue&type=script&lang=js&\"\nimport style0 from \"./call.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/call/call.vue\"\nexport default component.exports","export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./call.vue?vue&type=template&id=63abc074&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./call.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./call.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"mask\">\r\n\t\t<view class=\"top\">\r\n\t\t\t<view class=\"avatar\">\r\n\t\t\t\t<image :src=\"imgUrl+'/worker/new/index_ai_logo.png'\" mode=\"widthFix\">\r\n\t\t\t\t</image>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"gif_area\">\r\n\t\t\t\t<image :src=\"imgUrl+'/worker/new/noinput.webp'\" mode=\"widthFix\" class=\"noinput\"\r\n\t\t\t\t\t:class=\"aiSpeeking?'':'show'\">\r\n\t\t\t\t</image>\r\n\t\t\t\t<image :src=\"imgUrl+'/worker/answering.gif'\" mode=\"widthFix\" class=\"inputing\"\r\n\t\t\t\t\t:class=\"aiSpeeking?'show':''\"></image>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"bot\">\r\n\t\t\t<view class=\"input_tips\" v-show=\"inputStatus\">\r\n\t\t\t\t<image :src=\"imgUrl+'/worker/answering.gif'\" mode=\"widthFix\" class=\"inputing\">\r\n\t\t\t\t</image>\r\n\t\t\t\t<view class=\"\">请讲，正在听</view>\r\n\t\t\t</view>\r\n\t\t\t<!-- <view class=\"input_tips\" v-show=\"!inputStatus\" @click=\"interrupt\">\r\n\t\t\t\t<view class=\"sque\" v-show=\"aiSpeeking\"></view>\r\n\t\t\t\t<view class=\"\" v-show=\"aiSpeeking\">点击打断</view>\r\n\t\t\t</view> -->\r\n\t\t\t<view class=\"btn_area flex flex_around\" @click=\"close\">\r\n\t\t\t\t<image :src=\"imgUrl+'/worker/new/close_chat.png'\" mode=\"widthFix\"></image>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- <image :src=\"imgUrl+'/worker/new/noinput.webp'\" mode=\"widthFix\" class=\"noinput\" :class=\"inputStatus?'':'show'\">\r\n\t\t</image>\r\n\t\t<image :src=\"imgUrl+'/worker/new/inputing_wave2.gif'\" mode=\"widthFix\" class=\"inputing\"\r\n\t\t\t:class=\"inputStatus?'show':''\"></image> -->\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport urlSetting from \"../../url_setting\";\r\n\tconst BASE_URL = urlSetting.urls.voiceUrl\r\n\timport {\r\n\t\tmapState,\r\n\t\tmapMutations\r\n\t} from \"vuex\"\r\n\tconst app = getApp()\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\timgUrl: app.globalData.baseImageUrl,\r\n\t\t\t\tinputStatus: false, //用户输入状态\r\n\t\t\t\tmanager: uni.getRecorderManager(),\r\n\t\t\t\tlowVoiceCount: 0, //低分贝（连续低于20）次数,\r\n\t\t\t\taudioCtx: wx.createWebAudioContext(),\r\n\t\t\t\tcurrentPlayIndex: 0,\r\n\t\t\t\tsource: null,\r\n\t\t\t\taiSpeeking: true,\r\n\t\t\t\tindex: 0,\r\n\t\t\t\tresult: [],\r\n\t\t\t\ttipsText: \"请讲，正在听\",\r\n\t\t\t\tcloseStatus: false,\r\n\t\t\t\thighVoiceCount: 0, //高分贝（连续大于55）次数,由此判定用户是否有输入过语音\r\n\t\t\t\tlongTimeNoInput: false, //用户长时间未输入语音标志\r\n\t\t\t\taction: \"audio_call_user_enter\" //记录当前用户的动作：audio_call_user_enter 进入语音通话；audio_call_user_long_time_without_talking 语音通话用户长时间不响应\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync onLoad() {\r\n\t\t\t// 设置用户动作为进入通话\r\n\t\t\t// this.action = \"audio_call_user_enter\"\r\n\t\t\t// 发送用户进入会话动作给服务器\r\n\t\t\tthis.userEnter()\r\n\t\t\tthis.initRecord()\r\n\t\t\t// this.startRecord()\r\n\t\t},\r\n\t\tonUnload: function() {\r\n\t\t\tthis.close()\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tlowVoiceCount(newVaL) {\r\n\t\t\t\tif (newVaL > 30) {\r\n\t\t\t\t\t// 50的阈值大概8-10秒左右\r\n\t\t\t\t\tif (this.highVoiceCount < 20) {\r\n\t\t\t\t\t\tthis.longTimeNoInput = true //长时间未输入\r\n\t\t\t\t\t\tthis.action = \"audio_call_user_long_time_without_talking\"\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.inputStatus = false\r\n\t\t\t\t\tthis.manager.stop()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\thighVoiceCount(newVaL) {\r\n\t\t\t\tif (newVaL > 20) {\r\n\t\t\t\t\t// 50的阈值大概8-10秒左右\r\n\t\t\t\t\tthis.longTimeNoInput = false\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tinputStatus(newVal) {\r\n\t\t\t\tif (newVal) {\r\n\t\t\t\t\tthis.resetData()\r\n\t\t\t\t\tthis.startRecord()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t...mapState([\"answering\", \"connected\", \"connecting\", \"canSend\", \"inChannel\", \"answerContinue\", \"channelQaLen\",\r\n\t\t\t\t\"channelId\", \"channelQaList\", \"location\", \"token\"\r\n\t\t\t])\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tclose() {\r\n\t\t\t\tthis.closeStatus = true\r\n\t\t\t\t//关闭录音\r\n\t\t\t\tthis.manager.stop()\r\n\t\t\t\tif (this.audioCtx) {\r\n\t\t\t\t\t// 停止音频播放\r\n\t\t\t\t\tthis.audioCtx.close();\r\n\t\t\t\t\t// 清除 WebAudioContext 对象\r\n\t\t\t\t\tthis.audioCtx = null;\r\n\t\t\t\t}\r\n\t\t\t\tuni.navigateBack()\r\n\t\t\t},\r\n\t\t\tinterrupt() {\r\n\t\t\t\tif (this.aiSpeeking) {\r\n\t\t\t\t\tthis.audioCtx.close();\r\n\t\t\t\t\tthis.resetData()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tresetData() {\r\n\t\t\t\tthis.highVoiceCount = 0\r\n\t\t\t\tthis.longTimeNoInput = false\r\n\t\t\t\tthis.action = \"\"\r\n\t\t\t\tthis.lowVoiceCount = 0\r\n\t\t\t\tthis.index = 0\r\n\t\t\t\tthis.result = []\r\n\t\t\t\tthis.aiSpeeking = false\r\n\t\t\t\tthis.inputStatus = true\r\n\t\t\t},\r\n\t\t\tstartRecord() {\r\n\t\t\t\tthis.manager.start({\r\n\t\t\t\t\tformat: 'PCM',\r\n\t\t\t\t\tsampleRate: 8000,\r\n\t\t\t\t\tnumberOfChannels: 2,\r\n\t\t\t\t\tencodeBitRate: 16000,\r\n\t\t\t\t\tframeSize: 4,\r\n\t\t\t\t\tduration: 600000\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tinitRecord() {\r\n\t\t\t\t//录音开始事件\r\n\t\t\t\tthis.manager.onStart(e => {\r\n\t\t\t\t\tconsole.log(\"录音开始\")\r\n\t\t\t\t\tthis.inputStatus = true\r\n\t\t\t\t});\r\n\t\t\t\t//录音结束事件\r\n\t\t\t\tthis.manager.onStop(res => {\r\n\t\t\t\t\tlet _this = this\r\n\t\t\t\t\tconsole.log(\"录音结束：\", res)\r\n\t\t\t\t\t_this.inputStatus = false\r\n\t\t\t\t\t// 录音结束，发送语音数据给后台\r\n\t\t\t\t\tif (!this.closeStatus) {\r\n\t\t\t\t\t\tthis.handleRecorder(res)\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tthis.manager.onError(res => {\r\n\t\t\t\t\tlet _this = this\r\n\t\t\t\t\tthis.aiSpeeking = false\r\n\t\t\t\t\tthis.inputStatus = true\r\n\t\t\t\t\tconsole.log(\"call录音出错：\", res.errMsg)\r\n\t\t\t\t})\r\n\t\t\t\tthis.manager.onFrameRecorded((res) => {\r\n\t\t\t\t\tlet _this = this\r\n\t\t\t\t\tconst {\r\n\t\t\t\t\t\tframeBuffer\r\n\t\t\t\t\t} = res;\r\n\t\t\t\t\tlet uint16Array = new Int16Array(frameBuffer)\r\n\t\t\t\t\tlet len = uint16Array.length\r\n\t\t\t\t\tlet squareSum = 0\r\n\t\t\t\t\tuint16Array.forEach(uint16 => {\r\n\t\t\t\t\t\tsquareSum += uint16 * uint16\r\n\t\t\t\t\t})\r\n\t\t\t\t\tif (squareSum < 10000) return\r\n\t\t\t\t\tlet recordVolume = squareSum / len\r\n\t\t\t\t\tlet db = parseInt(10 * Math.log10(recordVolume))\r\n\t\t\t\t\tconsole.log(\"db:\", db)\r\n\t\t\t\t\tif (db < 55) {\r\n\t\t\t\t\t\t_this.lowVoiceCount++\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t_this.lowVoiceCount = 0\r\n\t\t\t\t\t\t_this.highVoiceCount++\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tuserEnter() {\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tconst binaryData = \"\"; //无语音输入\r\n\t\t\t\tlet midata = new Uint8Array(binaryData)\r\n\t\t\t\tlet time = new Date().getTime()\r\n\t\t\t\tlet id = uni.getStorageSync(\"openid\") + time\r\n\t\t\t\tlet binaryId = _this.stringToUint8Array(id + \"@@@\" + _this.channelId + \"@@@\" + _this.action)\r\n\t\t\t\t// 输出拼接后的 Uint8Array\r\n\t\t\t\t// 计算总长度\r\n\t\t\t\tconst totalLength = binaryId.length + midata.length;\r\n\t\t\t\t// 创建一个新的 Uint8Array，长度为所有数组的总和\r\n\t\t\t\tlet mergedArray = new Uint8Array(totalLength);\r\n\t\t\t\t// 使用 set 方法将每个 Uint8Array 的数据填充到新的 Uint8Array 中\r\n\t\t\t\tlet offset = 0;\r\n\t\t\t\tmergedArray.set(binaryId, offset);\r\n\t\t\t\toffset += binaryId.length;\r\n\t\t\t\tmergedArray.set(midata, offset);\r\n\t\t\t\t_this.sendMessage(mergedArray.buffer)\r\n\t\t\t},\r\n\t\t\t// 处理录音数据\r\n\t\t\thandleRecorder({\r\n\t\t\t\ttempFilePath,\r\n\t\t\t\tduration\r\n\t\t\t}) {\r\n\t\t\t\tlet _this = this\r\n\t\t\t\t// _this.sendMessage(data)\r\n\t\t\t\twx.getFileSystemManager().readFile({\r\n\t\t\t\t\tfilePath: tempFilePath,\r\n\t\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\t\t// res.data是录音文件的二进制数据\r\n\t\t\t\t\t\tconst binaryData = res.data;\r\n\t\t\t\t\t\tlet midata = new Uint8Array(binaryData)\r\n\t\t\t\t\t\tlet time = new Date().getTime()\r\n\t\t\t\t\t\tlet id = uni.getStorageSync(\"openid\") + time\r\n\t\t\t\t\t\tlet binaryId = _this.stringToUint8Array(id + \"@@@\" + _this.channelId + \"@@@\" + _this\r\n\t\t\t\t\t\t\t.action)\r\n\t\t\t\t\t\t// 输出拼接后的 Uint8Array\r\n\t\t\t\t\t\t// 计算总长度\r\n\t\t\t\t\t\tconst totalLength = binaryId.length + midata.length;\r\n\t\t\t\t\t\t// 创建一个新的 Uint8Array，长度为所有数组的总和\r\n\t\t\t\t\t\tlet mergedArray = new Uint8Array(totalLength);\r\n\t\t\t\t\t\t// 使用 set 方法将每个 Uint8Array 的数据填充到新的 Uint8Array 中\r\n\t\t\t\t\t\tlet offset = 0;\r\n\t\t\t\t\t\tmergedArray.set(binaryId, offset);\r\n\t\t\t\t\t\toffset += binaryId.length;\r\n\t\t\t\t\t\tmergedArray.set(midata, offset);\r\n\t\t\t\t\t\t_this.sendMessage(mergedArray.buffer)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: function(error) {\r\n\t\t\t\t\t\tconsole.error('读取文件失败：', error);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tstringToUint8Array(str) {\r\n\t\t\t\tconst utf8 = unescape(encodeURIComponent(str)); // 将字符串编码为 UTF-8\r\n\t\t\t\tconst len = utf8.length;\r\n\t\t\t\tconst arr = new Uint8Array(len);\r\n\t\t\t\tfor (let i = 0; i < len; i++) {\r\n\t\t\t\t\tarr[i] = utf8.charCodeAt(i);\r\n\t\t\t\t}\r\n\t\t\t\treturn arr;\r\n\t\t\t},\r\n\t\t\tsendMessage(data) {\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tconst requestTask = wx.request({\r\n\t\t\t\t\turl: BASE_URL,\r\n\t\t\t\t\tenableChunked: true,\r\n\t\t\t\t\theader: {\r\n\t\t\t\t\t\t'content-type': 'application/json',\r\n\t\t\t\t\t\t\"app-id\": urlSetting.urls.appid,\r\n\t\t\t\t\t\t\"open-id\": uni.getStorageSync(\"openid\") ? uni.getStorageSync(\"openid\") : \"\",\r\n\t\t\t\t\t\t\"address\": encodeURIComponent(JSON.stringify(_this.location)),\r\n\t\t\t\t\t\t\"Authorization\": \"bearer \" + uni.getStorageSync(\"token\"),\r\n\t\t\t\t\t\t\"Content-Type\": \"application/octet-stream\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tresponseType: 'arraybuffer',\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\tdata: data,\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tconsole.log('接收完毕', _this.result)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: res => {\r\n\t\t\t\t\t\tconsole.error('request fail', res)\r\n\t\t\t\t\t\t// reject()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\trequestTask.onChunkReceived((res) => {\r\n\t\t\t\t\tconsole.log(\"接收数据:\", res.data)\r\n\t\t\t\t\t_this.aiSpeeking = true\r\n\t\t\t\t\t_this.audioCtx.decodeAudioData(res.data, buffer => {\r\n\t\t\t\t\t\t_this.index++\r\n\t\t\t\t\t\tconsole.log(\"buffer:\", buffer)\r\n\t\t\t\t\t\t_this.result.push(buffer)\r\n\t\t\t\t\t\tif (_this.index == 1) {\r\n\t\t\t\t\t\t\t_this.play()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, err => {\r\n\t\t\t\t\t\tconsole.error('decodeAudioData fail', err)\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tplay() {\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tlet len = this.result.length\r\n\t\t\t\tconsole.log(\"播放\", this.currentPlayIndex, len)\r\n\t\t\t\tlet source = this.audioCtx.createBufferSource()\r\n\t\t\t\tsource.connect(this.audioCtx.destination)\r\n\t\t\t\tsource.buffer = this.result[this.currentPlayIndex]\r\n\t\t\t\tif (_this.currentPlayIndex == len) {\r\n\t\t\t\t\t_this.currentPlayIndex = 0\r\n\t\t\t\t\t_this.aiSpeeking = false\r\n\t\t\t\t\t_this.inputStatus = true\r\n\t\t\t\t\t_this.result = []\r\n\t\t\t\t\tsource.end()\r\n\t\t\t\t\tconsole.log(\"inputStatus:\", _this.inputStatus)\r\n\t\t\t\t\tconsole.log(\"aiSpeeking:\", _this.aiSpeeking)\r\n\t\t\t\t}\r\n\t\t\t\tsource.start()\r\n\t\t\t\tsource.onended = function() {\r\n\t\t\t\t\tconsole.log('音频播放结束');\r\n\t\t\t\t\tif (_this.currentPlayIndex < len) {\r\n\t\t\t\t\t\t_this.currentPlayIndex++\r\n\t\t\t\t\t\t_this.play()\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\t.mask {\r\n\t\tbackground: rgba(0, 0, 0, .9);\r\n\r\n\t\t.top {\r\n\t\t\tposition: absolute;\r\n\t\t\ttop: 230rpx;\r\n\t\t\tleft: 50%;\r\n\t\t\ttransform: translateX(-50%);\r\n\r\n\t\t\t.avatar {\r\n\t\t\t\tfont-size: 0;\r\n\r\n\t\t\t\timage {\r\n\t\t\t\t\twidth: 400rpx;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t.gif_area {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: 32rpx;\r\n\t\t\t\tright: -30rpx;\r\n\t\t\t\tbackground: #fff;\r\n\t\t\t\tpadding: 0rpx 20rpx;\r\n\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\tborder-radius: 40rpx;\r\n\t\t\t\tbox-shadow: 0 0 2rpx 5rpx #f1f1f1;\r\n\r\n\t\t\t\timage {\r\n\t\t\t\t\twidth: 100rpx;\r\n\t\t\t\t\tdisplay: none;\r\n\r\n\t\t\t\t\t&.show {\r\n\t\t\t\t\t\tdisplay: block;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.bot {\r\n\t\t\tposition: absolute;\r\n\t\t\tbottom: 70rpx;\r\n\t\t\tleft: 50%;\r\n\t\t\ttransform: translateX(-50%);\r\n\r\n\t\t\t.input_tips {\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tfont-size: 31rpx;\r\n\t\t\t\tcolor: #C5C5C5;\r\n\r\n\t\t\t\timage {\r\n\t\t\t\t\twidth: 100rpx;\r\n\t\t\t\t\t// margin-bottom: 20rpx;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.sque {\r\n\t\t\t\t\twidth: 38rpx;\r\n\t\t\t\t\theight: 38rpx;\r\n\t\t\t\t\tborder-radius: 8rpx;\r\n\t\t\t\t\tmargin: 0 auto 23rpx auto;\r\n\t\t\t\t\tbackground: #d4d4d4;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t.btn_area {\r\n\t\t\t\tmargin-top: 150rpx;\r\n\r\n\t\t\t\timage {\r\n\t\t\t\t\twidth: 138rpx;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// image {\r\n\t\t// \twidth: 70%;\r\n\t\t// \tposition: absolute;\r\n\t\t// \ttop: 50%;\r\n\t\t// \tleft: 50%;\r\n\t\t// \ttransform: translate(-50%, -50%);\r\n\t\t// \tdisplay: none;\r\n\r\n\t\t// \t&.show {\r\n\t\t// \t\tdisplay: block;\r\n\t\t// \t}\r\n\t\t// }\r\n\t}\r\n</style>","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./call.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./call.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1743642520995\n      var cssReload = require(\"E:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}